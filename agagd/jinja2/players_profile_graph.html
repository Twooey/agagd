{% block js %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.3.0/chart.min.js" integrity="sha512-yadYcDSJyQExcKhjKSQOkBKy2BLDoW6WnnGXCAkCoRlpHGpYuVuBqGObf3g/TdB86sSbss1AOP4YlGSb6EKQPg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

{% endblock js %}

<style type="text/css">
.chart-container {
  margin-left: auto;
  margin-right: auto;
  height: 90%;
  width: 90%;
}

</style>

<section class="container">
    <div class="row">
      <div class="col">
        <canvas id="player_chartjs_graph"></canvas>
      </div>
    </div>
    <div class="row">
      <div class="col my-2">
        <button type="button" class="btn btn-dark" id="1y">1 year</button>
        <button type="button" class="btn btn-dark" id="5y">5 years</button>
        <button type="button" class="btn btn-dark" id="10y">10 years</button>
     </div>
    </div>
</section>

<script type="text/javascript">
    const ctx = document.getElementById('player_chartjs_graph');
    const one_year = document.getElementById('1y');
    const five_years = document.getElementById('5y');
    const ten_years = document.getElementById('10y');

    const ratings_data_ajax_config = {
        url: "{{ url('member_ratings', args=[player.member_id, 1]) }}",
        async: false,
        dataType: "json",
    };
    var ratings_data = $.ajax(ratings_data_ajax_config).responseJSON;
    var playerChart;

    function create_chart() {
      playerChart = new Chart(ctx, {
        type: 'line',
        data: {
          datasets: [{
            data: ratings_data,
            borderColor: 'rgb(75, 192, 192)',
          }],
        },
        options: {
            parsing: {
              xAxisKey: 'elab_date',
              yAxisKey: 'rating',
            },
          plugins: {
            legend: {
               display: false
            },
          }
        }
      });
    }

    create_chart();

    one_year.addEventListener("click", function() {
      playerChart.destroy();
      const ratings_data_ajax_config = {
        url: "{{ url('member_ratings', args=[player.member_id, 1]) }}",
        async: false,
        dataType: "json",
      };
      ratings_data = $.ajax(ratings_data_ajax_config).responseJSON;
      create_chart();
    });

    five_years.addEventListener("click", function() {
      playerChart.destroy();
      const ratings_data_ajax_config = {
        url: "{{ url('member_ratings', args=[player.member_id, 5]) }}",
        async: false,
        dataType: "json",
      };
      ratings_data = $.ajax(ratings_data_ajax_config).responseJSON;
      create_chart();
    });

    ten_years.addEventListener("click", function() {
      playerChart.destroy();
      const ratings_data_ajax_config = {
        url: "{{ url('member_ratings', args=[player.member_id, 5]) }}",
        async: false,
        dataType: "json",
      };
      ratings_data = $.ajax(ratings_data_ajax_config).responseJSON;
      create_chart();
    });
</script>
